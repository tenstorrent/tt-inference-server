# SPDX-FileCopyrightText: Â© 2025 Tenstorrent Inc.
# SPDX-License-Identifier: Apache-2.0
#
# Mesh Graph Descriptor for Multi-Host N300 Setup (MPI Sockets)
#
# Topology: Two separate 1x2 meshes (one N300 each) on DIFFERENT HOSTS
# - mesh_id=0: N300 on host 1 (sender/prefill)
# - mesh_id=1: N300 on host 2 (receiver/decode)
#
# NO physical connections defined - hosts communicate via MPI (CPU-to-CPU)
#
# --- Meshes ---------------------------------------------------------------

mesh_descriptors {
  name: "SingleChip"
  arch: WORMHOLE_B0
  device_topology { dims: [ 1, 1 ] }  # Single chip (bypasses N300 internal connectivity)
  host_topology   { dims: [ 1, 1 ] }  # Single host per mesh
  channels {
    count: 2
    policy: RELAXED
  }
}

# --- Graphs ---------------------------------------------------------------

graph_descriptors {
  name: "MultiHostMPI"
  type: "FABRIC"

  # Two mesh instances on separate hosts - no physical connections
  instances { mesh { mesh_descriptor: "SingleChip" mesh_id: 0 } }
  instances { mesh { mesh_descriptor: "SingleChip" mesh_id: 1 } }

  # NOTE: No connections defined - hosts are separate and use MPI for communication
}

# --- Instantiation ----------------------------------------------------------
top_level_instance { graph { graph_descriptor: "MultiHostMPI" graph_id: 0 } }
